<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MILLÁN SISTEMA V36 - GOOGLE READY</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #ffd700; --dark: #111; --bg: #f4f4f4; --success: #00c851; --google: #4285F4; }
        body { font-family: sans-serif; margin: 0; padding: 0; background: var(--bg); padding-bottom: 80px; }
        .header { background: var(--dark); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .nav-btn { background: none; border: none; color: #888; font-size: 1.5rem; margin-left: 20px; cursor: pointer; }
        .nav-btn.active { color: var(--primary); }
        .page { display: none; padding: 15px; max-width: 900px; margin: 0 auto; }
        .page.active { display: block; }
        .search-box { width: 100%; padding: 15px; border-radius: 30px; border: 1px solid #ccc; font-size: 1.1rem; text-align: center; margin-bottom: 10px; }
        .btn-google { width: 100%; padding: 12px; background: white; border: 2px solid var(--google); color: var(--google); border-radius: 25px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .yuls-btn { position: fixed; bottom: 20px; right: 20px; width: 80px; height: 80px; background: #000; border: 3px solid var(--primary); border-radius: 50%; color: var(--primary); font-weight: bold; display: flex; align-items: center; justify-content: center; z-index: 2000; cursor: pointer; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #222; color: white; }
    </style>
</head>
<body>

<header class="header">
    <div style="font-weight:900;">MILLÁN <span style="color:var(--primary)">SISTEMA</span></div>
    <nav>
        <button onclick="showPage('home')" id="n-home" class="nav-btn active"><i class="fas fa-search"></i></button>
        <button onclick="showPage('pos')" id="n-pos" class="nav-btn"><i class="fas fa-shopping-cart"></i></button>
        <button onclick="askPin()" id="n-admin" class="nav-btn"><i class="fas fa-user-shield"></i></button>
    </nav>
</header>

<div class="yuls-btn" id="yuls-trigger" onclick="startYuls()">YULS</div>

<div id="home" class="page active">
    <input type="text" id="main-search" class="search-box" placeholder="Busca pieza carnal..." onkeyup="doSearch(this.value)">
    
    <button class="btn-google" onclick="searchInGoogle()">
        <i class="fab fa-google"></i> BUSCAR EN GOOGLE IMÁGENES
    </button>

    <div id="search-results"></div>
</div>

<div id="pos" class="page">
    <h2>LISTA DE COBRO</h2>
    <div id="cart-items"></div>
    <div style="text-align:right; margin-top:20px;">
        <h2 id="total-txt">Total: $0</h2>
        <button onclick="finishSale()" style="width:100%; padding:20px; background:var(--success); color:white; border:none; border-radius:10px; font-weight:bold;">IMPRIMIR TICKET</button>
    </div>
</div>

<div id="admin" class="page">
    <h2>CONTROL DE STOCK</h2>
    <div id="inv-summary" style="background:black; color:white; padding:15px; border-radius:10px; margin-bottom:10px;"></div>
    <table>
        <thead><tr><th>Pieza</th><th>Stock</th><th>Venta</th></tr></thead>
        <tbody id="admin-list"></tbody>
    </table>
</div>

<script>
    // Tu inventario real
    const RAW_DATA = [
        {c:"B55", n:"Modulo Tsuru 16V", s:5, cost:543},
        {c:"PC336246", n:"Portacarbón Ford/Nissan", s:10, cost:69},
        {c:"1224", n:"Bendix Zen 10D", s:4, cost:114},
        {c:"FC15A", n:"Fusible Clavija 15A", s:100, cost:0.85},
        {c:"67HELLA", n:"Foco 67 Hella", s:50, cost:3.30}
    ];

    let db = []; let cart = [];

    function init() {
        let saved = localStorage.getItem('millan_v36_db');
        if(saved) db = JSON.parse(saved);
        else {
            db = RAW_DATA.map(p => ({...p, p: Math.ceil(p.cost * 1.3)}));
            localStorage.setItem('millan_v36_db', JSON.stringify(db));
        }
        renderAdmin();
    }

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function doSearch(q) {
        const resDiv = document.getElementById('search-results');
        if(!q) { resDiv.innerHTML = ""; return; }
        let filtered = db.filter(p => p.n.toUpperCase().includes(q.toUpperCase()));
        
        if(filtered.length === 0) {
            resDiv.innerHTML = `<p style="text-align:center; color:red; font-weight:bold;">No la tengo en inventario carnal. Dale al botón de Google arriba.</p>`;
        } else {
            resDiv.innerHTML = filtered.map(p => `
                <div class="card">
                    <div><b>${p.n}</b><br><small>Stock: ${p.s}</small></div>
                    <div style="text-align:right">
                        <div style="color:green; font-weight:bold;">$${p.p}</div>
                        <button onclick="addToCart('${p.c}')">Anotar</button>
                    </div>
                </div>
            `).join('');
        }
    }

    function searchInGoogle() {
        let q = document.getElementById('main-search').value;
        if(!q) q = "refaccion automotriz";
        window.open(`https://www.google.com/search?tbm=isch&q=${q}`, '_blank');
    }

    function addToCart(code) {
        let p = db.find(x => x.c === code);
        if(p && p.s > 0) {
            cart.push(p);
            p.s--;
            localStorage.setItem('millan_v36_db', JSON.stringify(db));
            alert("Anotado!");
            renderAdmin();
        }
    }

    function renderAdmin() {
        const list = document.getElementById('admin-list');
        list.innerHTML = db.map(p => `<tr><td>${p.n}</td><td>${p.s}</td><td>$${p.p}</td></tr>`).join('');
    }

    function askPin() { if(prompt("PIN:")==="1234") showPage('admin'); }

    // --- EL YULS ---
    function startYuls() {
        const rec = new webkitSpeechRecognition();
        rec.lang = "es-MX";
        rec.onresult = (e) => {
            let t = e.results[0][0].transcript.toLowerCase();
            let p = db.find(x => t.includes(x.n.toLowerCase()));
            if(p) {
                speak(`¡Simón! Del ${p.n} tengo ${p.s} piezas. Cuesta ${p.p} varos.`);
                doSearch(p.n);
            } else {
                speak("Esa no la tengo en el estante carnal, ¿la buscamos en el Google?");
                setTimeout(() => { searchInGoogle(); }, 2000);
            }
        };
        rec.start();
    }

    function speak(m) {
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(m));
    }

    init();
</script>
</body>
</html>
