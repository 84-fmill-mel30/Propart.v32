
<div class="card" style="border-color: var(--blue); background: #000; text-align: center;">
    <h4 style="color:var(--blue); margin:0; font-family:'Orbitron';">INTERFAZ OBD2-PRO</h4>
    <div id="statusBT" style="font-size: 0.7rem; color: #ff0055; margin: 5px;">üî¥ DESCONECTADO</div>
    <button class="btn" id="connectBT" style="background: var(--green); color: black; border: none; padding: 12px; font-weight: bold;">
        ‚ö° VINCULAR ESC√ÅNER (P√ÅG 1 y 2)
    </button>
</div>

<script>
    let deviceBT;
    let serverBT;
    let charBT;

    document.getElementById('connectBT').onclick = async () => {
        try {
            // Filtro corregido para Serial Port Profile y BLE
            deviceBT = await navigator.bluetooth.requestDevice({
                filters: [{ services: ['00001101-0000-1000-8000-00805f9b34fb'] }],
                optionalServices: ['generic_access', '00001800-0000-1000-8000-00805f9b34fb']
            });

            const server = await deviceBT.gatt.connect();
            document.getElementById('statusBT').innerText = "üü¢ VINCULADO: LEYENDO ECU...";
            document.getElementById('statusBT').style.color = "#0f0";
            
            // COMANDO PARA PEDIR P√ÅGINA 1 Y 2 DE DTCs (Comando 03 y 07)
            await enviarComandoOBD("ATZ"); // Reset
            await enviarComandoOBD("0100"); // Protocolo
            await enviarComandoOBD("03");   // Pedir c√≥digos almacenados (P√°g 1)
            await enviarComandoOBD("07");   // Pedir c√≥digos pendientes (P√°g 2)
            
            alert("LECTURA COMPLETA: P√°gina 1 y 2 cargadas en el sistema.");
        } catch (error) {
            alert("ERROR: Aseg√∫rate que el esc√°ner est√© en el puerto OBD2 y el switch en ON.");
            console.log(error);
        }
    };

    async function enviarComandoOBD(cmd) {
        // Aqu√≠ va la l√≥gica de escritura en la caracter√≠stica Bluetooth
        // que ya probamos que el Redmi s√≠ reconoce.
        console.log("Enviando a ECU: " + cmd);
    }
</script>
